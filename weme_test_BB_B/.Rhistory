# Fit Binomial
binomial_methods = lapply(
1:n_binomial_methods,
function(x) fit_Binomial(dataset,seed = x)
)
bb@coef[1]
binomial_methods
n_methods = n_betabinomial_methods + n_binomial_methods
# Dump data
sapply(1:n_methods, function(i) {
output_folder = paste0('./', rndm_folder, "/method", i)
output_file = paste0(output_folder, '/test_subclonal_structure.txt')
dir.create(output_folder, recursive = TRUE)
if(i <= n_binomial_methods)
readr::write_tsv(binomial_methods[[i]], output_file)
else
readr::write_tsv(betabinomial_methods[[i- n_binomial_methods]], output_file)
})
# Source WeMe
source("/Users/salvatore.milite/work/Trieste/analysis/overdispersion/weme_test_BB_B/weme.R")
# Run WeMe
setwd(rndm_folder)
sids = find_sids()
genconsensus(sids, rounddown = FALSE, ncores = 1)
load("./results.rda")
setwd('..')
result = result  %>% distinct(phi, method)
result
table_runs = easypar::run(FUN =
function(i)
{
set.seed(i)
require(dplyr)
source("sampler.R")
overdispersion = runif(1, 0.001, qgamma(0.85, shape = shape, rate = rate))
#overdispersion = rgamma(1, shape = shape, rate = rate)
N = runif(1, 500, 5000) %>% round()
coverage = rpois(1,lambda = 45) %>% round()
smpl <- sampler(
overdispersion = overdispersion,
N = N,
coverage = rpois(N, coverage),
n_binomial_methods = grid_samples$n_binomial_methods[i],
n_betabinomial_methods = grid_samples$n_betabinomial_methods[i],
seed = i
) %>%
mutate(
overdispersion = overdispersion,
N = N,
coverage = coverage
)
smpl <- smpl %>% as_tibble() %>%  mutate(i = i)
smpl
},PARAMS = lapply(1:4, list),parallel = FALSE, export = c("grid_samples", "shape", "rate"), filter_errors = FALSE, cores.ratio = 0.6)
table_runs$`1`
table_runs$`2`
require(dplyr)
require(patchwork)
set.seed(3)
source("sampler.R")
fit_Binomial_fixed_p = function(x,p1, p2, seed = 3)
{
library(matrixStats)
library(VGAM)
set.seed(seed)
phi1 = runif(1)
p = c(p1,p2)
phi = c(phi1, 1 - phi1)
E_tol = 1e-3
S = x$NV
N = x$DP
lk1 = dbinom(S, p[1], size = N, log = T) + log(phi[1])
lk2 = dbinom(S, p[2], size = N, log = T) + log(phi[2])
lk = apply(cbind(lk1, lk2), 1,  logSumExp, simplify = TRUE)
tol = Inf
idx = 1
while(tol > E_tol | idx < 3) {
# E step
z = lk1 - lk
z = exp(z)
#M step
phi1 = sum(z) / length(N)
phi = c(phi1, 1 - phi1)
lk1 = dbinom(S, p[1], size = N, log = T) + log(phi[1])
lk2 = dbinom(S, p[2], size = N, log = T) + log(phi[2])
lk_old = lk
lk = apply(cbind(lk1, lk2), 1,  logSumExp, simplify = TRUE)
tol = abs(sum(lk_old) - sum(lk))
idx = idx + 1
}
return(c(-sum(lk),  phi[1]))
}
overdispersion = 0.015
#overdispersion = rgamma(1, shape = shape, rate = rate)
N = 5000
coverage = rpois(1,lambda = 45) %>% round()
smpl <- simulate_data(
overdispersion = overdispersion,
N = N,
coverage = rpois(N, coverage),
seed = i
)
grid = expand.grid(p1 = seq(0.1,0.9,by = 0.01),p2 = seq(0.1,0.9,by = 0.01))
res = easypar::run(FUN = function(x) {
fit_Binomial_fixed_p(smpl, grid[x,1], grid[x,2])
}
,PARAMS = lapply(1:nrow(grid), list),parallel = FALSE,cache = FALSE,
export = c("grid", "smpl", "fit_Binomial_fixed_p"), filter_errors = FALSE,
cores.ratio = 0.6
)
grid %>%  saveRDS("grid_ps.rds")
lks <- res %>% do.call(cbind, .)
grid$lk <-  lks[1,]
grid$phi <- lks[2,]
grid %>%  saveRDS("grid_ps.rds")
p1 <- ggplot(grid, aes(p1, p2, fill= lk)) +
geom_tile() +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() +
theme_minimal() + ggtitle("Assignment probs to p1 for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk)) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral") +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("prob", palette = "Spectral") +
theme_minimal() + ggtitle("Assignment probs to p1 for fixed values of prob")
p1 | p2
grid$phi <-  which.max(grid$phi , 1 - grid$phi)
p1 <- ggplot(grid, aes(p1, p2, fill= lk)) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Assignment probs to p1 for fixed values of prob")
grid$phi <-  pmax(grid$phi , 1 - grid$phi)
p1 <- ggplot(grid, aes(p1, p2, fill= lk)) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Assignment probs to p1 for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk)) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk)) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral", direction = 1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk)) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= sqrt(lk))) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= log(lk))) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid)) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour()
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z =lk))
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk))
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk), binwidth = 0.001)
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk), binwidth = 100)
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk), binwidth = 1000)
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk), binwidth = 1000, alpha = 0.6, color = "grey")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk), binwidth = 1000, alpha = 0.6, color = "black")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk), binwidth = 1000, alpha = 0.6, color = "black", lty = "2")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk), binwidth = 1000, alpha = 0.6, color = "black", lty = "--")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = -lk), binwidth = 1000, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk/ nrow(grdi)), binwidth = 1, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk/ nrow(grid)), binwidth = 1, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk/ nrow(grid)), binwidth = 0.5, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = log10(lk)), binwidth = 0.5, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = log10(lk)), binwidth = 2, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = log10(lk)), binwidth = 0.01, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = log10(lk)), bins = 30, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = log10(lk)), bins = 50, alpha = 0.6, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk, after_stat(alpha)), bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk, alpha = after_stat(lk)), bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk, alpha = lk ), bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk, alpha = -lk ), bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk, alpha = -lk ), bins = 1000, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = lk, alpha = -log10(lk) ), bins = 1000, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = if_else(lk < 3000, lk, 0) ), bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = if_else(lk < 3000, lk, 1) ), bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 3000, lk, 1) ), bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
grid$lk
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 30000, lk, 1) ), bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 20000, lk, 1) ),alpha = 0.45, bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 10000, lk, 0) ),alpha = 0.45, bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 15000, lk, 0) ),alpha = 0.45, bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 15000, lk, NA) ),alpha = 0.45, bins = 100, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 15000, lk, NA) ),alpha = 0.45, bins = 10, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 15000, lk, NA) ), size = 0.8,alpha = 0.45, bins = 10, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 15000, lk, NA) ), size = 0.5,alpha = 0.45, bins = 10, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
p1 | p2
(p1 | p2) %>%  saveRDS(file = "supp2_ab.rds")
(p1 | p2) %>%  ggsave(.,filename = "supp2_ab.png", device = "png", scale = "px", width = 1600, height = 600)
(p1 | p2) %>%  ggsave(plot = .,filename = "supp2_ab.png", device = "png", scale = "px", width = 1600, height = 600)
(p1 | p2) %>%  ggsave(plot = .,filename = "supp2_ab.png", device = "png", scale = "px", width = 1600, height = 800)
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 12000, lk, NA) ), size = 0.5,alpha = 0.45, bins = 10, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
(p1 | p2)
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 14000, lk, NA) ), size = 0.5,alpha = 0.45, bins = 10, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
(p1 | p2)
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 14500, lk, NA) ), size = 0.5,alpha = 0.45, bins = 10, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
(p1 | p2)
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 14500, lk, NA) ), size = 0.5,alpha = 0.45, bins = 50, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
(p1 | p2)
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 14500, lk, NA) ), size = 0.5,alpha = 0.45, bins = 20, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
(p1 | p2)
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 14500, lk, NA) ), size = 0.5,alpha = 0.45, bins = 15, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
(p1 | p2)
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 15000, lk, NA) ), size = 0.5,alpha = 0.45, bins = 15, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
(p1 | p2)
p1 <- ggplot(grid, aes(p1, p2, fill= lk / nrow(grid))) +
geom_tile() + scale_fill_distiller("NLL/N", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("NLL for fixed values of prob") + geom_contour( aes(z = ifelse(lk < 15000, lk, NA) ), size = 0.5,alpha = 0.45, bins = 10, color = "black", lty = "dashed")
p2 <- ggplot(grid, aes(p1, p2, fill= phi)) +
geom_tile() + scale_fill_distiller("maxprob", palette = "Spectral", direction = -1) +
theme_minimal() + ggtitle("Max phi for fixed values of prob")
(p1 | p2)
