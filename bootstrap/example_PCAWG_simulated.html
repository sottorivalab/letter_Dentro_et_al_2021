<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

        <meta name="author" content="Salvatore Milite" />
    
    
    <title>Example_with_PCWAG_tools</title>

        <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="site_libs/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <script src="site_libs/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
    <script src="site_libs/navigation-1.1/tabsets.js"></script>
    <link href="site_libs/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
    <script src="site_libs/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
    <link href="site_libs/downcute-0.1/downcute.css" rel="stylesheet" />
    <link href="site_libs/downcute-0.1/downcute_fonts_embed.css" rel="stylesheet" />
    <script src="site_libs/downcute-0.1/downcute_styles.js"></script>
    <script src="site_libs/downcute-0.1/downcute.js"></script>
    <script src="site_libs/prism-1.22/prism.js"></script>
    
    
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

                  <!-- downcute start -->   
   <div id="docute" class="Root theme-default">
     <div class="Page layout-narrow">
      <div class="Wrap">
        <div class="Sidebar">
          <div class="SidebarItems" id="toc">
            
          </div>
          <div data-position="sidebar:post-end" class="InjectedComponents"><div class="dark-theme-toggler"><div class="toggle "><div class="toggle-track"><div class="toggle-track-check"><img  src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div> <div class="toggle-track-x"><img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div></div> <div class="toggle-thumb"></div></div> <input type="checkbox" aria-label="Switch between Dark and Default theme" class="toggler-screen-reader-only"></div></div>
        </div>
        <div class="Main">
          <div class="Content" id="content"> 
   
   
      
   <div class="navbar navbar-default  navbar-fixed-top" role="navigation">
     <div class="container">
       <div class="navbar-header">
         <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
         </button>
         <a class="navbar-brand" href="index.html">Letter</a>
       </div>
       <div id="navbar" class="navbar-collapse collapse">
         <ul class="nav navbar-nav">
           <li>
     <a href="index.html">Home</a>
   </li>
   <li>
     <a href="data.html">PCAWG data</a>
   </li>
   <li>
     <a href="fits.html">PCAWG fits</a>
   </li>
   <li>
     <a href="example_PCAWG_simulated.html">Simulations of PCAWG methods</a>
   </li>
         </ul>
         <ul class="nav navbar-nav navbar-right">
           
         </ul>
       </div><!--/.nav-collapse -->
     </div><!--/.container -->
   </div><!--/.navbar -->
        
      <h1 class="title">Example_with_PCWAG_tools</h1>
      
      <p class="authors">
           <span class="glyphicon glyphicon-user"></span> Salvatore Milite
      </p>
            
   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div class="page-content has-page-title">
<pre class="r"><code>knitr::opts_chunk$set(eval = FALSE)</code></pre>
<p>In this notebook we want to provide an example of consensus clustering similar to that adopted in PCWAG. We generated a simulated dataset from a negative binomial with coverage 50 and overdispersion of 0.015, two values that well represent the data used in Dentro et al.</p>
<p>In this case we simulated only the clonal cluster of a tumor with 65% purity and we ran 2 tools with binomial likelihood and one with beta-binomial likelihood. The tools were chosen to have a similar ratio to that found in the original pipeline (2 vs 7). We did not implement exactly the original pipeline because of the difficulty to reproduce some model selection procedures (as with CliP) or the lack of some specific inputs used to build the files used for clustering (Sclust). In particular we chose:</p>
<ul>
<li>Pyclone-vi (beta-binomial)</li>
<li>Ccube (normal-binomial)</li>
<li>Dpclust (binomial)</li>
</ul>
<p>In that they are effectively documented, and easily usable with simulated data. To avoid versioning issues the packages used were included in the code bundle.</p>
<pre class="r"><code>set.seed(1234)

# Used packages
require(dplyr)
require(ggplot2)
require(cowplot)
require(VGAM)
require(ccube)
require(mclust)
require(fpc)
require(matrixStats)
require(readr)</code></pre>
<pre class="r"><code>MEAN_COV &lt;- 45
RHO &lt;- 0.015
N &lt;- 5000
purity  &lt;-  0.65

# Poisson distributed coverage
DP &lt;-  rpois(N, MEAN_COV)


hist(DP)</code></pre>
<pre class="r"><code>NV &lt;- rbetabinom(N, size = DP, prob = 0.5 * purity, rho = RHO)

hist(NV)</code></pre>
<pre class="r"><code>chr &lt;- rep(1, N)

position &lt;- sample.int(1e8, size = N, replace = T) %&gt;% sort()


hist(NV/DP)

inp &lt;-  data.frame(chr, position, DP, NV, VAF = NV /DP)

save(inp,file = &quot;input_data.rda&quot;)</code></pre>
<pre class="r"><code>### CCUBE : Normal-Binomial


# We run ccube as in the vignette
numOfClusterPool = 1:6
numOfRepeat = 5


ccube_inp &lt;- data.frame(major_cn = 1, minor_cn = 1, total_cn = 2, 
                        purity = purity, normal_cn = 1,
                        mutation_id = paste(chr, position, sep = &quot;_&quot;),
                        var_counts = NV,
                        ref_counts = DP - NV,
                        total_counts = DP) %&gt;% as_tibble()


results_ccube &lt;- RunCcubePipeline(ssm = ccube_inp, 
                            numOfClusterPool = numOfClusterPool, 
                            numOfRepeat = numOfRepeat,
                            runAnalysis = T, 
                            runQC = T)


save(results_ccube, file = &quot;results_ccube.rda&quot;)</code></pre>
<pre class="r"><code>load(&quot;results_ccube.rda&quot;)
MakeCcubeStdPlot(ssm = results_ccube$ssm, res = results_ccube$res)</code></pre>
<pre class="r"><code>### Dpclust : Binomial

dir.create(&quot;dpclust_input&quot;)

 data.frame(chr = chr, end = position,
            Reference_Allele = &quot;A&quot;, Tumor_Seq_Allele2 = &quot;T&quot;,
                          mut.count  = NV, WT.count = DP - NV,
            subclonal.CN     = 2, mutation.copy.number   = 1,
            subclonal.fraction   = 1, no.chrs.bearing.mut   =1) %&gt;% 
  readr::write_tsv(., &quot;dpclust_input/sample0_input.txt&quot;)
 
 data.frame(sample = &quot;sample0&quot;, subsample = &quot;01&quot;,
            datafile = &quot;./sample0_input.txt&quot;, cellularity = purity
                         ) %&gt;%
  readr::write_tsv(., &quot;dpclust_input/sample0.txt&quot;)</code></pre>
<pre class="bash"><code>## For dpclust we use the pipeline that can be found in the package, it is also available as a docker image

mkdir -p output_dpclust
cd dpclust/inst/example

R --vanilla --slave -q -f dpclust_pipeline.R --args -r 1 -d ../../../dpclust_input/ -o ../../../output_dpclust -i ../../../dpclust_input/sample0.txt
</code></pre>
<pre class="r"><code>cluster_composition_dpclust &lt;-  readr::read_tsv(&quot;output_dpclust/sample0_DPoutput_2000iters_1000burnin_seed123/sample0_2000iters_1000burnin_bestClusterInfo.txt&quot;, col_types = cols())

print(cluster_composition_dpclust)</code></pre>
<pre class="r"><code>### Pyclone-vi : BetaBinomial

dir.create(&quot;pyclone_input&quot;, showWarnings = F)

 data.frame(mutation_id = paste0(&quot;S_&quot;,1:length(DP)), sample_id = &quot;example&quot;,
                          alt_counts     = NV, ref_counts = DP - NV,
            normal_cn    = 2, major_cn   = 1,
            minor_cn    = 1, tumour_content = purity) %&gt;% 
  readr::write_tsv(., &quot;pyclone_input/sample0_input.tsv&quot;)</code></pre>
<pre class="bash"><code>
source ~/miniforge3/etc/profile.d/conda.sh

conda activate pyclone-vi

mkdir output_pyclone

pyclone-vi fit -i pyclone_input/sample0_input.tsv -o output_pyclone/example.h5 -c 40 -d beta-binomial -r 10

pyclone-vi write-results-file -i output_pyclone/example.h5 -o output_pyclone/example.tsv
</code></pre>
<pre class="r"><code># We then ave to prepare the input for weme

dir.create(&quot;weme/example_simulated&quot;, showWarnings = F)


dir.create(&quot;weme/example_simulated/method1&quot;, showWarnings = F)

load(&quot;results_ccube.rda&quot;, verbose = T)

results_ccube$ssm$cluster_id &lt;- results_ccube$res$label

ccube_sc = results_ccube$ssm %&gt;% group_by(cluster_id) %&gt;% summarise(n_ssms = n(), proportion = ccube_ccf_mean %&gt;%  unique()) %&gt;%  rename(cluster = cluster_id) %&gt;%  select(cluster, n_ssms, proportion) %&gt;%  mutate(proportion = proportion * purity)

readr::write_tsv(&quot;weme/example_simulated/method1/example_subclonal_structure.txt&quot;, x = ccube_sc %&gt;%  filter(n_ssms &gt; 50) %&gt;%  arrange(-proportion)%&gt;% mutate(cluster = 1:length(cluster)))

dir.create(&quot;weme/example_simulated/method2&quot;, showWarnings = F)


## dpclust apparently returns the location in terms of total tumour cells so we multiply it by purity
dpclust_sc &lt;-  cluster_composition_dpclust %&gt;%  rename(cluster = cluster.no, proportion = location, n_ssms = no.of.mutations) %&gt;%  
  mutate(proportion= proportion * purity) %&gt;% select(cluster, n_ssms, proportion)

readr::write_tsv(&quot;weme/example_simulated/method2/example_subclonal_structure.txt&quot;, x = dpclust_sc %&gt;%  filter(n_ssms &gt; 50) %&gt;%  arrange(-proportion)%&gt;% mutate(cluster = 1:length(cluster)))


dir.create(&quot;weme/example_simulated/method3&quot;, showWarnings = F)

pyclone_out &lt;- readr::read_tsv(&quot;output_pyclone/example.tsv&quot;, col_types = cols()) %&gt;% group_by(cluster_id, cellular_prevalence) %&gt;%  summarize(n_ssms = n())

pyclone_sc &lt;-  pyclone_out %&gt;%  rename(cluster = cluster_id, proportion = cellular_prevalence) %&gt;%  select(cluster, n_ssms, proportion) %&gt;% 
  mutate(proportion = proportion * purity)

readr::write_tsv(&quot;weme/example_simulated/method3/example_subclonal_structure.txt&quot;, x = pyclone_sc %&gt;%  filter(n_ssms &gt; 50) %&gt;%  arrange(-proportion) %&gt;% mutate(cluster = 1:length(cluster)))</code></pre>
<p>From the results extracted from weme we see that although pyclone-vi correctly clusters the data into a single cluster (excluding an extremely small cluster on the left tail that is filtered out), the push by other algorithms to fragment the clonal cluster into two results in consensus clustering that is wrong with respect to the starting generative model.</p>
<pre class="r"><code>setwd(&quot;weme/example_simulated/&quot;)
source(&quot;../weme.R&quot;)

sids = find_sids()


genconsensus(sids,rounddown=FALSE)

print(&quot;pyclone-vi&quot;)
read.table(file = &quot;./method3/example_subclonal_structure.txt&quot;, header = T)
print(&quot;ccube&quot;)
read.table(file = &quot;./method1/example_subclonal_structure.txt&quot;, header = T)
print(&quot;dpclust&quot;)
read.table(file = &quot;./method2/example_subclonal_structure.txt&quot;, header = T)



print(&quot;consensus&quot;)
read.table(file = &quot;./example_subclonal_structure.txt&quot;, header = T)</code></pre>
</div>

   
   
              </div>
  </div>
  </div>
  </div>
   
      

  <script>
    $(document).ready(function () {

		// add bootstrap table styles to pandoc tables
	$('tr.header').parent('thead').parent('table').addClass('table table-condensed');
		
 	 	$('#content img').addClass("image-thumb");
		
		$('#content img:not(.no-lightbox)').addClass("image-lb");
	$('#content').magnificPopup({
	    type:'image',
	    closeOnContentClick: false,
	    closeBtnInside: false,
	    delegate: '.image-lb',
	    gallery: {enabled: false },
	    image: {
	        verticalFit: true,
		titleSrc: 'alt'
	    }
 	});
 	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
